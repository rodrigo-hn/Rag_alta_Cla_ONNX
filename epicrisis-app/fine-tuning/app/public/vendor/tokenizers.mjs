var S=class{constructor(e){this.trie=this._build_trie(e)}_build_trie(e){let t=Object.create(null);for(let o of e){let n=t;for(let s=0;s<o.length;++s){let i=o[s];n=n[i]??=Object.create(null)}n.end=o}return t}split(e){let t=[],o=e.length,n=0,s=0;for(;s<o;){let i=this.trie,c=null,a=s;for(;a<o&&(i=i[e[a]]);)i.end&&(c=i.end),++a;c?(s>n&&t.push(e.slice(n,s)),t.push(c),s+=c.length,n=s):++s}return n<o&&t.push(e.slice(n)),t}},xt=S;var M=class{constructor(e){this.content=e.content,this.id=e.id,this.single_word=e.single_word??!1,this.lstrip=e.lstrip??!1,this.rstrip=e.rstrip??!1,this.special=e.special??!1,this.normalized=e.normalized??null}},B=M;var R=(()=>{let r=[...Array.from({length:94},(n,s)=>s+33),...Array.from({length:12},(n,s)=>s+161),...Array.from({length:82},(n,s)=>s+174)],e=r.slice(),t=0;for(let n=0;n<256;++n)r.includes(n)||(r.push(n),e.push(256+t),t+=1);let o=e.map(n=>String.fromCharCode(n));return Object.fromEntries(r.map((n,s)=>[n,o[s]]))})(),Ut=r=>Object.fromEntries(Object.entries(r).map(([e,t])=>[t,e])),yt=Ut(R),Tt=".,!?\u2026\u3002\uFF0C\u3001\u0964\u06D4\u060C",Pt=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"],["(?i:[sdmt]|ll|ve|re)","(?:[sS]|[dD]|[mM]|[tT]|[lL][lL]|[vV][eE]|[rR][eE])"],["[^\\r\\n\\p{L}\\p{N}]?+","[^\\r\\n\\p{L}\\p{N}]?"],["[^\\s\\p{L}\\p{N}]++","[^\\s\\p{L}\\p{N}]+"],[` ?[^(\\s|[${Tt}])]+`,` ?[^\\s${Tt}]+`]]),x="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",Yt=new RegExp(`^[${x}]+$`,"gu");var T=r=>r.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n't/g,"n't").replace(/ 'm/g,"'m").replace(/ 's/g,"'s").replace(/ 've/g,"'ve").replace(/ 're/g,"'re"),z=(r,e=!0)=>{if(r.Regex!==void 0){let t=r.Regex.replace(/\\([#&~])/g,"$1");for(let[o,n]of Pt)t=t.replaceAll(o,n);return new RegExp(t,"gu")}else if(r.String!==void 0){let t=$t(r.String);return new RegExp(e?t:`(${t})`,"gu")}else return console.warn("Unknown pattern type:",r),null},$t=r=>r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),wt=(r,e,t)=>{let o=[],n=0;for(;n<r.length;){if(o.push(r[n]),(e.get(r[n])??t)!==t){++n;continue}for(;++n<r.length&&(e.get(r[n])??t)===t;)e.get(o.at(-1))!==t&&(o[o.length-1]+=r[n])}return o},Ct=r=>r>=19968&&r<=40959||r>=13312&&r<=19903||r>=131072&&r<=173791||r>=173824&&r<=177983||r>=177984&&r<=178207||r>=178208&&r<=183983||r>=63744&&r<=64255||r>=194560&&r<=195103,vt=r=>Number.isInteger(r)||typeof r=="bigint",Nt=r=>{let e=0;for(let t of r)++e;return e},At=r=>F(r.toLowerCase()),f=(...r)=>Array.prototype.concat.apply([],r),y=r=>new Map(Object.entries(r)),Et=(r,e)=>{let t=[],o=0;for(let n of r.matchAll(e)){let s=n[0];o<n.index&&t.push(r.slice(o,n.index)),s.length>0&&t.push(s),o=n.index+s.length}return o<r.length&&t.push(r.slice(o)),t},F=r=>r.replace(/\p{M}/gu,""),L=(r,e,t=[])=>{if(!r||Array.isArray(r)||typeof r!="object")return`${e} must be a valid object`;for(let o of t)if(!(o in r))return`${e} must contain a "${o}" property`;return null},Dt=r=>r.match(/\S+/g)||[];var j=class{constructor(){let e=function(...t){return e._call(...t)};return Object.setPrototypeOf(e,new.target.prototype)}},_=j;var U=class extends _{constructor(e){super(),this.config=e}_call(e){return this.normalize(e)}},d=U;var $=class extends d{tokenize_chinese_chars(e){let t=[];for(let o=0;o<e.length;++o){let n=e[o],s=n.charCodeAt(0);Ct(s)?(t.push(" "),t.push(n),t.push(" ")):t.push(n)}return t.join("")}strip_accents(e){return e.normalize("NFD").replace(/\p{Mn}/gu,"")}is_control(e){switch(e){case"	":case`
`:case"\r":return!1;default:return/^\p{Cc}|\p{Cf}|\p{Co}|\p{Cs}$/u.test(e)}}clean_text(e){let t=[];for(let o of e){let n=o.charCodeAt(0);n===0||n===65533||this.is_control(o)||(/^\s$/.test(o)?t.push(" "):t.push(o))}return t.join("")}normalize(e){return this.config.clean_text&&(e=this.clean_text(e)),this.config.handle_chinese_chars&&(e=this.tokenize_chinese_chars(e)),this.config.lowercase?(e=e.toLowerCase(),this.config.strip_accents!==!1&&(e=this.strip_accents(e))):this.config.strip_accents&&(e=this.strip_accents(e)),e}},q=$;var W=class extends d{constructor(e){super(e),this.charsmap=e.precompiled_charsmap??null}normalize(e){return e=e.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),e=e.replace(/[\u0009\u000A\u000C\u000D\u00A0\u1680\u2000-\u200F\u2028\u2029\u202F\u205F\u2581\u3000\uFEFF\uFFFD]/gm," "),e.includes("\uFF5E")?e=e.split("\uFF5E").map(o=>o.normalize("NFKC")).join("\uFF5E"):e=e.normalize("NFKC"),e}},K=W;var I=class extends d{constructor(e){super(e),this.normalizers=(e.normalizers??[]).map(t=>w(t))}normalize(e){return this.normalizers.reduce((t,o)=>o?o.normalize(t):t,e)}},G=I;var V=class extends d{normalize(e){let t=z(this.config.pattern??{});return t===null?e:e.replaceAll(t,this.config.content??"")}},X=V;var J=class extends d{constructor(){super(...arguments);this.form="NFC"}normalize(t){return t=t.normalize(this.form),t}},b=J;var Y=class extends b{constructor(){super(...arguments);this.form="NFC"}},H=Y;var Q=class extends b{constructor(){super(...arguments);this.form="NFD"}},Z=Q;var ee=class extends b{constructor(){super(...arguments);this.form="NFKC"}},te=ee;var re=class extends b{constructor(){super(...arguments);this.form="NFKD"}},oe=re;var ne=class extends d{normalize(e){return this.config.strip_left&&this.config.strip_right?e=e.trim():(this.config.strip_left&&(e=e.trimStart()),this.config.strip_right&&(e=e.trimEnd())),e}},se=ne;var ie=class extends d{normalize(e){return F(e)}},ae=ie;var ce=class extends d{normalize(e){return e.toLowerCase()}},pe=ce;var le=class extends d{normalize(e){return e=this.config.prepend+e,e}},ue=le;function qt(r){if(r===null)return null;switch(r.type){case"BertNormalizer":return new q(r);case"Precompiled":return new K(r);case"Sequence":return new G(r);case"Replace":return new X(r);case"NFC":return new H(r);case"NFD":return new Z(r);case"NFKC":return new te(r);case"NFKD":return new oe(r);case"Strip":return new se(r);case"StripAccents":return new ae(r);case"Lowercase":return new pe(r);case"Prepend":return new ue(r);default:throw new Error(`Unknown Normalizer type: ${r.type}`)}}var w=qt;var de=class extends _{pre_tokenize(e,t){return(Array.isArray(e)?e.map(o=>this.pre_tokenize_text(o,t)):this.pre_tokenize_text(e,t)).flat()}_call(e,t){return this.pre_tokenize(e,t)}},l=de;var fe=class extends l{constructor(e){super(),this.config=e,this.add_prefix_space=this.config.add_prefix_space??!1,this.trim_offsets=this.config.trim_offsets??!1,this.use_regex=this.config.use_regex??!0,this.pattern=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu,this.byte_encoder=R,this.text_encoder=new TextEncoder}pre_tokenize_text(e,t){return this.add_prefix_space&&!e.startsWith(" ")&&(e=" "+e),(this.use_regex?e.match(this.pattern)||[]:[e]).map(n=>Array.from(this.text_encoder.encode(n),s=>this.byte_encoder[s]).join(""))}},me=fe;var _e=class extends l{pre_tokenize_text(e,t){return e.match(/\w+|[^\w\s]+/g)||[]}},he=_e;var ge=class extends l{constructor(e){super(),this.replacement=e.replacement??"\u2581",this.str_rep=e.str_rep||this.replacement,this.prepend_scheme=e.prepend_scheme??"always"}pre_tokenize_text(e,t){let{section_index:o=void 0}=t??{},n=e.replaceAll(" ",this.str_rep);return!n.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&o===0)&&(n=this.str_rep+n),[n]}},ke=ge;var ze=class extends l{constructor(e){super(),this.config=e,this.pattern=z(this.config.pattern??{},this.config.invert??!0)}pre_tokenize_text(e){return this.pattern===null?[]:this.config.invert?e.match(this.pattern)||[]:this.config.behavior?.toLowerCase()==="removed"?e.split(this.pattern).filter(t=>t):Et(e,this.pattern)}},be=ze;var xe=class extends l{constructor(e){super(),this.config=e,this.pattern=new RegExp(`[^${x}]+|[${x}]+`,"gu")}pre_tokenize_text(e){return e.match(this.pattern)||[]}},Te=xe;var ye=class extends l{constructor(e){super(),this.config=e;let t=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(t,"gu")}pre_tokenize_text(e){return e.match(this.pattern)||[]}},Pe=ye;var we=class extends l{constructor(){super(),this.pattern=new RegExp(`[^\\s${x}]+|[${x}]`,"gu")}pre_tokenize_text(e,t){return e.trim().match(this.pattern)||[]}},Ce=we;var ve=class extends l{constructor(e){super(),this.config=e,this.pattern=z(this.config.pattern??{}),this.content=this.config.content??""}pre_tokenize_text(e){return this.pattern===null?[e]:[e.replaceAll(this.pattern,this.config.content??"")]}},Ot=ve;var Ne=class extends l{constructor(e){super(),this.tokenizers=(e.pretokenizers??[]).map(t=>C(t))}pre_tokenize_text(e,t){return this.tokenizers.reduce((o,n)=>n?n.pre_tokenize(o,t):o,[e])}},Ae=Ne;var Ee=class extends l{pre_tokenize_text(e){return Dt(e)}},De=Ee;function Wt(r){if(r===null)return null;switch(r.type){case"BertPreTokenizer":return new Ce;case"Sequence":return new Ae(r);case"Whitespace":return new he;case"WhitespaceSplit":return new De;case"Metaspace":return new ke(r);case"ByteLevel":return new me(r);case"Split":return new be(r);case"Punctuation":return new Te(r);case"Digits":return new Pe(r);case"Replace":return new Ot(r);default:throw new Error(`Unknown PreTokenizer type: ${r.type}`)}}var C=Wt;var Oe=class extends _{constructor(e){super(),this.config=e,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}_call(e){let t=this.encode(e);return this.fuse_unk&&(t=wt(t,this.tokens_to_ids,this.unk_token_id)),t}convert_tokens_to_ids(e){return e.map(t=>this.tokens_to_ids.get(t)??this.unk_token_id)}convert_ids_to_tokens(e){return e.map(t=>this.vocab[Number(t)]??this.unk_token)}},k=Oe;var Se=class extends k{constructor(t){super(t);this.max_input_chars_per_word=100;this.tokens_to_ids=y(t.vocab),this.unk_token_id=this.tokens_to_ids.get(t.unk_token),this.unk_token=t.unk_token,this.max_input_chars_per_word=t.max_input_chars_per_word??100,this.vocab=new Array(this.tokens_to_ids.size);for(let[o,n]of this.tokens_to_ids)this.vocab[n]=o}encode(t){let o=[];for(let n of t){let s=[...n];if(s.length>this.max_input_chars_per_word){o.push(this.unk_token);continue}let i=!1,c=0,a=[];for(;c<s.length;){let p=s.length,m=null;for(;c<p;){let g=s.slice(c,p).join("");if(c>0&&(g=this.config.continuing_subword_prefix+g),this.tokens_to_ids.has(g)){m=g;break}--p}if(m===null){i=!0;break}a.push(m),c=p}i?o.push(this.unk_token):o.push(...a)}return o}},v=Se;var N=class r{constructor(e,t){this.is_leaf=e,this.children=t}static default(){return new r(!1,new Map)}},Me=class{constructor(){this.root=N.default()}extend(e){for(let t of e)this.push(t)}push(e){let t=this.root;for(let o of e){let n=t.children.get(o);n===void 0&&(n=N.default(),t.children.set(o,n)),t=n}t.is_leaf=!0}*common_prefix_search(e){let t=this.root;if(t===void 0)return;let o="";for(let n of e){if(o+=n,t=t.children.get(n),t===void 0)return;t.is_leaf&&(yield o)}}},St=Me;var P=class r{constructor(e,t,o,n,s){this.token_id=e,this.node_id=t,this.pos=o,this.length=n,this.score=s,this.prev=null,this.backtrace_score=0}clone(){let e=new r(this.token_id,this.node_id,this.pos,this.length,this.score);return e.prev=this.prev,e.backtrace_score=this.backtrace_score,e}},Be=class{constructor(e,t,o){this.chars=Array.from(e),this.len=this.chars.length,this.bos_token_id=t,this.eos_token_id=o,this.nodes=[],this.begin_nodes=Array.from({length:this.len+1},()=>[]),this.end_nodes=Array.from({length:this.len+1},()=>[]);let n=new P(this.bos_token_id??0,0,0,0,0),s=new P(this.eos_token_id??0,1,this.len,0,0);this.nodes.push(n.clone()),this.nodes.push(s.clone()),this.begin_nodes[this.len].push(s),this.end_nodes[0].push(n)}insert(e,t,o,n){let s=this.nodes.length,i=new P(n,s,e,t,o);this.begin_nodes[e].push(i),this.end_nodes[e+t].push(i),this.nodes.push(i)}viterbi(){let e=this.len,t=0;for(;t<=e;){if(this.begin_nodes[t].length==0)return[];for(let c of this.begin_nodes[t]){c.prev=null;let a=0,p=null;for(let m of this.end_nodes[t]){let g=m.backtrace_score+c.score;(p===null||g>a)&&(p=m.clone(),a=g)}if(p!==null)c.prev=p,c.backtrace_score=a;else return[]}++t}let o=[],s=this.begin_nodes[e][0].prev;if(s===null)return[];let i=s.clone();for(;i.prev!==null;)o.push(i.clone()),i=i.clone().prev.clone();return o.reverse(),o}piece(e){return this.chars.slice(e.pos,e.pos+e.length).join("")}tokens(){return this.viterbi().map(t=>this.piece(t))}token_ids(){return this.viterbi().map(t=>t.token_id)}},Mt=Be;function Bt(r){if(r.length===0)throw new Error("Array must not be empty");let e=r[0],t=0;for(let o=1;o<r.length;++o)r[o]<e&&(e=r[o],t=o);return[e,t]}var Re=class extends k{constructor(e,t){super(e);let o=e.vocab.length;this.vocab=new Array(o),this.scores=new Array(o);for(let n=0;n<o;++n)[this.vocab[n],this.scores[n]]=e.vocab[n];this.unk_token_id=e.unk_id,this.unk_token=this.vocab[e.unk_id],this.tokens_to_ids=new Map(this.vocab.map((n,s)=>[n,s])),this.bos_token=" ",this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=t,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.unk_token=this.vocab[this.unk_token_id],this.min_score=Bt(this.scores)[0],this.unk_score=this.min_score-10,this.scores[this.unk_token_id]=this.unk_score,this.trie=new St,this.trie.extend(this.vocab),this.fuse_unk=!0}populate_nodes(e){let t=e.chars,o=1,n=0;for(;n<t.length;){let s=!1,i=[],c=t.slice(n).join(""),a=this.trie.common_prefix_search(c);for(let p of a){i.push(p);let m=this.tokens_to_ids.get(p),g=this.scores[m],bt=Nt(p);e.insert(n,bt,g,m),!s&&bt===o&&(s=!0)}s||e.insert(n,o,this.unk_score,this.unk_token_id),n+=o}}tokenize(e){let t=new Mt(e,this.bos_token_id,this.eos_token_id);return this.populate_nodes(t),t.tokens()}encode(e){let t=[];for(let o of e){let n=this.tokenize(o);t.push(...n)}return t}},A=Re;var Fe=class{constructor(e=(o,n)=>o>n,t=1/0){this._heap=[],this._comparator=e,this._max_size=t}get size(){return this._heap.length}is_empty(){return this.size===0}peek(){return this._heap[0]}push(...e){return this.extend(e)}extend(e){for(let t of e)if(this.size<this._max_size)this._heap.push(t),this._sift_up();else{let o=this._smallest();this._comparator(t,this._heap[o])&&(this._heap[o]=t,this._sift_up_from(o))}return this.size}pop(){let e=this.peek(),t=this.size-1;return t>0&&this._swap(0,t),this._heap.pop(),this._sift_down(),e}replace(e){let t=this.peek();return this._heap[0]=e,this._sift_down(),t}_parent(e){return(e+1>>>1)-1}_left(e){return(e<<1)+1}_right(e){return e+1<<1}_greater(e,t){return this._comparator(this._heap[e],this._heap[t])}_swap(e,t){let o=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=o}_sift_up(){this._sift_up_from(this.size-1)}_sift_up_from(e){for(;e>0&&this._greater(e,this._parent(e));)this._swap(e,this._parent(e)),e=this._parent(e)}_sift_down(){let e=0;for(;this._left(e)<this.size&&this._greater(this._left(e),e)||this._right(e)<this.size&&this._greater(this._right(e),e);){let t=this._right(e)<this.size&&this._greater(this._right(e),this._left(e))?this._right(e):this._left(e);this._swap(e,t),e=t}}_smallest(){return 2**Math.floor(Math.log2(this.size))-1}},Rt=Fe;var Le=class{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;let t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}put(e,t){this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,t),this.cache.size>this.capacity&&this.cache.delete(this.cache.keys().next().value)}clear(){this.cache.clear()}},Ft=Le;var je=class extends k{constructor(e){super(e),this.tokens_to_ids=y(e.vocab),this.unk_token_id=this.tokens_to_ids.get(e.unk_token),this.unk_token=e.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(let[o,n]of this.tokens_to_ids)this.vocab[n]=o;let t=Array.isArray(e.merges[0]);this.merges=t?e.merges:e.merges.map(o=>o.split(" ",2)),this.bpe_ranks=new Map(this.merges.map((o,n)=>[JSON.stringify(o),n])),this.end_of_word_suffix=e.end_of_word_suffix,this.continuing_subword_suffix=e.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.max_length_to_cache=256,this.cache_capacity=1e4,this.cache=new Ft(this.cache_capacity)}clear_cache(){this.cache.clear()}bpe(e){if(e.length===0)return[];let t=this.cache.get(e);if(t!==void 0)return t;let o=Array.from(e);this.end_of_word_suffix&&(o[o.length-1]+=this.end_of_word_suffix);let n=[];if(o.length>1){let s=new Rt((a,p)=>a.score<p.score),i={token:o[0],bias:0,prev:null,next:null},c=i;for(let a=1;a<o.length;++a){let p={bias:a/o.length,token:o[a],prev:c,next:null};c.next=p,this.add_node(s,c),c=p}for(;!s.is_empty();){let a=s.pop();if(a.deleted||!a.next||a.next.deleted)continue;if(a.deleted=!0,a.next.deleted=!0,a.prev){let m={...a.prev};a.prev.deleted=!0,a.prev=m,m.prev?m.prev.next=m:i=m}let p={token:a.token+a.next.token,bias:a.bias,prev:a.prev,next:a.next.next};p.prev?(p.prev.next=p,this.add_node(s,p.prev)):i=p,p.next&&(p.next.prev=p,this.add_node(s,p))}for(let a=i;a!==null;a=a.next)n.push(a.token)}else n=o;if(this.continuing_subword_suffix)for(let s=0;s<n.length-1;++s)n[s]+=this.continuing_subword_suffix;return e.length<this.max_length_to_cache&&this.cache.put(e,n),n}add_node(e,t){let o=this.bpe_ranks.get(JSON.stringify([t.token,t.next.token]));o!==void 0&&(t.score=o+t.bias,e.push(t))}encode(e){let t=[];for(let o of e){if(this.ignore_merges&&this.tokens_to_ids.has(o)){t.push(o);continue}let n=this.bpe(o);for(let s of n)if(this.tokens_to_ids.has(s))t.push(s);else if(this.byte_fallback){let i=Array.from(this.text_encoder.encode(s)).map(c=>`<0x${c.toString(16).toUpperCase().padStart(2,"0")}>`);i.every(c=>this.tokens_to_ids.has(c))?t.push(...i):t.push(this.unk_token)}else t.push(this.unk_token)}return t}},E=je;var Ue=class extends k{constructor(e,t){super(e);let o=e.vocab;this.tokens_to_ids=y(t.target_lang?o[t.target_lang]:o),this.bos_token=t.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=t.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=t.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=t.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(let[n,s]of this.tokens_to_ids)this.vocab[s]=n}encode(e){return e}},Lt=Ue;function Kt(r,e){switch(r.type){case"WordPiece":return new v(r);case"Unigram":return new A(r,e.eos_token);case"BPE":return new E(r);default:if(r.vocab)return Array.isArray(r.vocab)?new A(r,e.eos_token):Object.hasOwn(r,"continuing_subword_prefix")&&Object.hasOwn(r,"unk_token")?Object.hasOwn(r,"merges")?new E(r):new v(r):new Lt(r,{target_lang:e.target_lang,bos_token:e.bos_token,eos_token:e.eos_token,pad_token:e.pad_token,unk_token:e.unk_token});throw new Error(`Unknown TokenizerModel type: ${r?.type}`)}}var jt=Kt;var $e=class extends _{constructor(e){super(),this.config=e}_call(e,...t){return this.post_process(e,...t)}},h=$e;var qe=class extends h{post_process(e,t=null,o=!0){let n=t===null?this.config.single:this.config.pair,s=[],i=[];for(let c of n)"SpecialToken"in c?o&&(s.push(c.SpecialToken.id),i.push(c.SpecialToken.type_id)):"Sequence"in c&&(c.Sequence.id==="A"?(s=f(s,e),i=f(i,new Array(e.length).fill(c.Sequence.type_id))):c.Sequence.id==="B"&&(s=f(s,t),i=f(i,new Array(t.length).fill(c.Sequence.type_id))));return{tokens:s,token_type_ids:i}}},We=qe;var Ke=class extends h{post_process(e,t=null){return{tokens:t?f(e,t):e}}},Ie=Ke;var Ge=class extends h{constructor(e){super(e),this.sep=e.sep,this.cls=e.cls}post_process(e,t=null,o=!0){o&&(e=f([this.cls[0]],e,[this.sep[0]]));let n=new Array(e.length).fill(0);if(t){let s=[],i=o?[this.sep[0]]:[];e=f(e,s,t,i),n=f(n,new Array(t.length+s.length+i.length).fill(1))}return{tokens:e,token_type_ids:n}}},Ve=Ge;var Xe=class extends h{constructor(e){super(e),this.sep=e.sep,this.cls=e.cls}post_process(e,t,o=!0){o&&(e=f([this.cls[0]],e,[this.sep[0]]));let n=new Array(e.length).fill(0);if(t){let s=o?[this.sep[0]]:[],i=o?[this.sep[0]]:[];e=f(e,s,t,i),n=f(n,new Array(t.length+s.length+i.length).fill(1))}return{tokens:e,token_type_ids:n}}},Je=Xe;var Ye=class extends h{constructor(e){super(e),this.processors=(e.processors??[]).map(t=>D(t))}post_process(e,t=null,o=!0){let n={tokens:e};for(let s of this.processors)n=s.post_process(n.tokens,t,o);return n}},He=Ye;function It(r){if(r===null)return null;switch(r.type){case"TemplateProcessing":return new We(r);case"ByteLevel":return new Ie(r);case"BertProcessing":return new Ve(r);case"RobertaProcessing":return new Je(r);case"Sequence":return new He(r);default:throw new Error(`Unknown PostProcessor type: ${r.type}`)}}var D=It;var Qe=class extends _{constructor(e){super(),this.config=e,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets="trim_offsets"in e?e.trim_offsets:!1}_call(e){return this.decode(e)}decode(e){return this.decode_chain(e).join("")}},u=Qe;var Ze=class extends u{constructor(e){super(e),this.byte_decoder=yt,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(e){let t=e.join(""),o=new Uint8Array([...t].map(n=>this.byte_decoder[n]));return this.text_decoder.decode(o)}decode_chain(e){let t=[],o=[];for(let n of e)this.added_tokens.find(s=>s.content===n)!==void 0?(o.length>0&&(t.push(this.convert_tokens_to_string(o)),o=[]),t.push(n)):o.push(n);return o.length>0&&t.push(this.convert_tokens_to_string(o)),t}},et=Ze;var tt=class extends u{constructor(e){super(e),this.cleanup=e.cleanup}decode_chain(e){return e.map((t,o)=>{if(o!==0){let n=this.config.prefix;n&&t.startsWith(n)?t=t.replace(n,""):t=" "+t}return this.cleanup&&(t=T(t)),t})}},rt=tt;var ot=class extends u{constructor(e){super(e),this.replacement=e.replacement??"\u2581"}decode_chain(e){let t=[];for(let o=0;o<e.length;++o){let n=e[o].replaceAll(this.replacement," ");o==0&&n.startsWith(" ")&&(n=n.substring(1)),t.push(n)}return t}},nt=ot;var st=class extends u{constructor(e){super(e),this.suffix=e.suffix??""}decode_chain(e){return e.map((t,o)=>t.replaceAll(this.suffix,o===e.length-1?"":" "))}},it=st;var at=class extends u{constructor(e){super(e),this.pad_token=e.pad_token??"",this.word_delimiter_token=e.word_delimiter_token??"",this.cleanup=e.cleanup}convert_tokens_to_string(e){if(e.length===0)return"";let t=[e[0]];for(let s=1;s<e.length;++s)e[s]!==t.at(-1)&&t.push(e[s]);let n=t.filter(s=>s!==this.pad_token).join("");return this.cleanup&&(n=T(n).replaceAll(this.word_delimiter_token," ").trim()),n}decode_chain(e){return[this.convert_tokens_to_string(e)]}},ct=at;var pt=class extends u{constructor(e){super(e),this.decoders=(e.decoders??[]).map(t=>O(t))}decode_chain(e){return this.decoders.reduce((t,o)=>o.decode_chain(t),e)}},lt=pt;var ut=class extends u{decode_chain(e){let t=z(this.config.pattern),o=this.config.content??"";return t===null?e:e.map(n=>n.replaceAll(t,o))}},dt=ut;var ft=class extends u{decode_chain(e){return[e.join("")]}},mt=ft;var _t=class extends u{constructor(e){super(e),this.content=e.content??"",this.start=e.start??0,this.stop=e.stop??0}decode_chain(e){return e.map(t=>{let o=0;for(let s=0;s<this.start&&t[s]===this.content;++s){o=s+1;continue}let n=t.length;for(let s=0;s<this.stop;++s){let i=t.length-s-1;if(t[i]===this.content){n=i;continue}else break}return t.slice(o,n)})}},ht=_t;var gt=class extends u{constructor(e){super(e),this.text_decoder=new TextDecoder}decode_chain(e){let t=[],o=[];for(let n of e){let s=null;if(n.length===6&&n.startsWith("<0x")&&n.endsWith(">")){let i=parseInt(n.slice(3,5),16);isNaN(i)||(s=i)}if(s!==null)o.push(s);else{if(o.length>0){let i=this.text_decoder.decode(Uint8Array.from(o));t.push(i),o=[]}t.push(n)}}if(o.length>0){let n=this.text_decoder.decode(Uint8Array.from(o));t.push(n),o=[]}return t}},kt=gt;function Gt(r){if(r===null)return null;switch(r.type){case"ByteLevel":return new et(r);case"WordPiece":return new rt(r);case"Metaspace":return new nt(r);case"BPEDecoder":return new it(r);case"CTC":return new ct(r);case"Sequence":return new lt(r);case"Replace":return new dt(r);case"Fuse":return new mt(r);case"Strip":return new ht(r);case"ByteFallback":return new kt(r);default:throw new Error(`Unknown Decoder type: ${r.type}`)}}var O=Gt;var zt=class{constructor(e,t){let o=L(e,"Tokenizer",["model","decoder","post_processor","pre_tokenizer","normalizer"]);if(o)throw new Error(o);let n=L(t,"Config");if(n)throw new Error(n);this.tokenizer=e,this.config=t,this.normalizer=w(this.tokenizer.normalizer),this.pre_tokenizer=C(this.tokenizer.pre_tokenizer),this.model=jt(this.tokenizer.model,this.config),this.post_processor=D(this.tokenizer.post_processor),this.decoder=O(this.tokenizer.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[],this.tokenizer.added_tokens.forEach(s=>{let i=new B(s);this.added_tokens.push(i),this.model.tokens_to_ids.set(i.content,i.id),this.model.vocab[i.id]=i.content,i.special&&(this.special_tokens.push(i.content),this.all_special_ids.push(i.id))}),(this.config.additional_special_tokens??[]).forEach(s=>{this.special_tokens.includes(s)||this.special_tokens.push(s)}),this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_splitter=new xt(this.added_tokens.map(s=>s.content)),this.added_tokens_map=new Map(this.added_tokens.map(s=>[s.content,s])),this.remove_space=this.config.remove_space,this.clean_up_tokenization_spaces=this.config.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=this.config.do_lowercase_and_remove_accent??!1}encode(e,{text_pair:t=null,add_special_tokens:o=!0,return_token_type_ids:n=null}={}){let{tokens:s,token_type_ids:i}=this.tokenize_helper(e,{text_pair:t,add_special_tokens:o}),c=this.model.convert_tokens_to_ids(s),a={ids:c,tokens:s,attention_mask:new Array(c.length).fill(1)};return n&&i&&(a.token_type_ids=i),a}decode(e,t={}){if(!Array.isArray(e)||e.length===0||!vt(e[0]))throw Error("token_ids must be a non-empty array of integers.");let o=this.model.convert_ids_to_tokens(e);t.skip_special_tokens&&(o=o.filter(s=>!this.special_tokens.includes(s)));let n=this.decoder?this.decoder(o):o.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(n=n.replaceAll(this.decoder.end_of_word_suffix," "),t.skip_special_tokens&&(n=n.trim())),(t.clean_up_tokenization_spaces??this.clean_up_tokenization_spaces)&&(n=T(n)),n}tokenize(e,{text_pair:t=null,add_special_tokens:o=!1}={}){return this.tokenize_helper(e,{text_pair:t,add_special_tokens:o}).tokens}encode_text(e){if(e===null)return null;let t=this.added_tokens_splitter.split(e);return t.forEach((o,n)=>{let s=this.added_tokens_map.get(o);s&&(s.lstrip&&n>0&&(t[n-1]=t[n-1].trimEnd()),s.rstrip&&n<t.length-1&&(t[n+1]=t[n+1].trimStart()))}),t.flatMap((o,n)=>{if(o.length===0)return[];if(this.added_tokens_map.has(o))return[o];if(this.remove_space===!0&&(o=o.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(o=At(o)),this.normalizer!==null&&(o=this.normalizer(o)),o.length===0)return[];let s=this.pre_tokenizer!==null?this.pre_tokenizer(o,{section_index:n}):[o];return this.model(s)})}tokenize_helper(e,{text_pair:t=null,add_special_tokens:o=!0}){let n=this.encode_text(e),s=this.encode_text(t||null);return this.post_processor?this.post_processor(n,s,o):{tokens:f(n??[],s??[])}}token_to_id(e){return this.model.tokens_to_ids.get(e)}id_to_token(e){return this.model.vocab[e]}get_added_tokens_decoder(){let e=new Map;for(let t of this.added_tokens)e.set(t.id,t);return e}},Vt=zt;export{B as AddedToken,E as BPE,it as BPEDecoder,q as BertNormalizer,Ce as BertPreTokenizer,Ve as BertProcessingPostProcessor,kt as ByteFallbackDecoder,et as ByteLevelDecoder,Ie as ByteLevelPostProcessor,me as ByteLevelPreTokenizer,ct as CTCDecoder,u as Decoder,Pe as DigitsPreTokenizer,mt as FuseDecoder,pe as LowercaseNormalizer,nt as MetaspaceDecoder,ke as MetaspacePreTokenizer,k as Model,H as NFCNormalizer,Z as NFDNormalizer,te as NFKCNormalizer,oe as NFKDNormalizer,d as Normalizer,h as PostProcessor,l as PreTokenizer,K as PrecompiledNormalizer,ue as PrependNormalizer,Te as PunctuationPreTokenizer,dt as ReplaceDecoder,X as ReplaceNormalizer,Je as RobertaProcessingPostProcessor,lt as SequenceDecoder,G as SequenceNormalizer,He as SequencePostProcessor,Ae as SequencePreTokenizer,be as SplitPreTokenizer,ae as StripAccentsNormalizer,ht as StripDecoder,se as StripNormalizer,We as TemplateProcessingPostProcessor,Vt as Tokenizer,A as Unigram,he as WhitespacePreTokenizer,De as WhitespaceSplitPreTokenizer,v as WordPiece,rt as WordPieceDecoder};
